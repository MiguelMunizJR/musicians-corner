---
import AuthButtons from "../auth/AuthButtons.astro";

import { supabase } from "@/lib/supabase";
import SideMenuItem from "../SideMenuItem.astro";
import { ROUTES_PATH } from "@/const";
import EnterIcon from "@/icons/dashboard/EnterIcon.astro";
const { cookies } = Astro;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

const { data, error } = await supabase.auth.setSession({
  refresh_token: refreshToken?.value || "",
  access_token: accessToken?.value || "",
});

if (error) {
  cookies.delete("sb-access-token", {
    path: "/",
  });
  cookies.delete("sb-refresh-token", {
    path: "/",
  });
}

const isLoggin = data?.user ? true : false;
---

<div class="relative h-screen overflow-hidden">
  <img
    src="/images/hero-bg.jpg"
    alt="bg-hero"
    class="object-cover w-full h-full opacity-40"
    loading="lazy"
  />

  <div
    class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center text-white"
  >
    <h1 class="text-6xl font-bold mb-8">
      Bienvenido a Musician's <span class="text-[#26ab3c]">Corner</span>
    </h1>
    <p class="mx-auto w-[65%] text-pretty font-light text-white/90 mb-14">
      Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ac purus sit
      amet lectus fermentum venenatis. Integer eu lacus vel ligula vehicula
      fermentum. Quisque aliquam turpis in faucibus dapibus. Curabitur id urna
      id metus volutpat volutpat non at elit. Sed feugiat sapien id massa
      laoreet, eu vulputate nisi convallis. Maecenas ut elit vel orci
      scelerisque bibendum nec non nisl. Nullam nec vulputate dui, sit amet
      aliquet erat. Integer eu feugiat ligula. Etiam vel est purus.
    </p>
    {
      !isLoggin ? (
        <AuthButtons className="flex gap-4" />
      ) : (
        <div class="flex justify-center">
          <SideMenuItem
            href={ROUTES_PATH.DASHBOARD}
            className="bg-[#26ab3c] hover:bg-[#36b84b] flex justify-center items-center py-3 px-4"
          >
            <EnterIcon className="w-6 h-6" />
            Ir al Dashboard
          </SideMenuItem>
        </div>
      )
    }
  </div>
</div>
